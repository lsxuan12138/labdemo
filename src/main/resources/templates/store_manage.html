<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Bootstrap 4, from LayoutIt!</title>

	<meta name="description" content="Source code generated using layoutit.com">
	<meta name="author" content="LayoutIt!">
	<!-- CSS -->
	<link rel="stylesheet" href="/static/bootstrap-4.5.3-dist/css/bootstrap.min.css">
	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="/static/js/jquery-3.5.1.min.js"></script>

	<!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
	<script src="/static/bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js"></script>
	<style type="text/css">
		/* 弹窗 (background) */
		.modal {
			display: none; /* 默认隐藏 */
			position: fixed; /* 固定定位 */
			z-index: 1; /* 设置在顶层 */
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgb(0,0,0);
			background-color: rgba(0,0,0,0.4);
		}

		/* 弹窗内容 */
		.modal-content {
			background-color: #fefefe;
			margin: 15% auto;
			padding: 20px;
			border: 1px solid #888;
			width: 30%;
			height: 20%;
		}

		/* 关闭按钮 */
		.close {
			color: #aaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: black;
			text-decoration: none;
			cursor: pointer;
		}
	</style>

</head>
<body>

<div class="container">
	<div class="row-fluid">
		<div class="span12">
			<h3 class="text-center text-info">
				通用批发零售业务管理系统v1.0
			</h3>
		</div>
		<div class="container-fluid" >
			<div class="row">
				<div class="col-md-12">
					<ul class="nav nav-tabs">
						<li class="nav-item">
							<a class="nav-link " href="/">返回主菜单</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="/getClients">顾客资料维护</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="/getProducts">商品资料维护</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active disabled" href="#">库存管理</a>
						</li>
						<li class="nav-item">
							<a class="nav-link " href="/getSellNotes">销售业务管理</a>
						</li>

					</ul>
				</div>
				<p class="text-info">
					<strong>您现在访问的是：库存管理</strong>
				</p>
			</div>
		</div>

	</div>
	<div class="row-fluid">
		<div class="span3">
			<p class="text-left">
				<strong>商品名称：</strong>
			</p>
		</div>
		<div class="span3">
			<form class="form-search" th:action="@{/product/findInStore}" th:method="post" th:object="${searchInfo}">
				<input class="input-medium search-query" type="text" id="findInput" th:placeholder="${keyword}" th:field="*{key}"></input>
				<button type="submit" class="btn btn-primary mr-sm-2">查找</button>

			</form>
		</div>
	</div>
	<div class="container">
		<div class="span12"  >
			<table class="table table-bordered table-hover" id="tab" >
				<thead>
				<tr>
					<th>商品ID</th>
					<th>商品名称</th>
					<th>商品数量</th>
					<th>操作</th>
				</tr>
				</thead>
				<tbody  class="info">
				<tr th:each="product:${products}" >
					<td th:text="${product.id}">1</td>
					<td th:text="${product.name}">华为手机</td>
					<td th:text="${product.quantity}">50</td>
					<td>
						<input class="btn btn-info btn-large" type="button" value="商品进货"/>
					</td>
				</tr>

				</tbody>
			</table>
		</div>
	</div>

	<div class="span3">
		<!-- 弹窗 -->
		<div id="purchaseModel" class="modal">
			<!-- 弹窗内容 -->
			<div class="modal-content">
				<div class="modal-body"><!--绑定span-->
					<span class="close" id="purchaseWindowClose">&times;</span>
					<p id="purchaseWindowTitle"></p>
					<lable for="popInput"><strong>进货数量：</strong></lable>
					<input class="input-medium search-query" id= "popInput" type="text" />
					<button class="btn btn-info btn-large" id="submitBtn" type="button" onclick="submit()">确定</button>
				</div>
			</div>

		</div>
	</div>
	<script type="text/javascript">
		// 获取弹窗
		var modal1 = document.getElementById('purchaseModel');

		// 打开弹窗的按钮对象
		// var btn1 = document.getElementById("purchaseBtn");

		// 获取 <span> 元素，用于关闭弹窗
		var span1 = document.getElementById("purchaseWindowClose");

		var productId ;
		let currQuan;
		let tableRow;
		//
		// // 点击按钮打开弹窗
		// btn1.onclick = function() {
		// 	modal1.style.display = "block";
		// }
		// 点击 <span> (x), 关闭弹窗
		span1.onclick = function() {
			modal1.style.display = "none";
			$('#popInput').val("");
		}

		// 在用户点击其他地方时，关闭弹窗
		window.onclick = function(event) {
			if (event.target === modal1) {
				modal1.style.display = "none";
				$('#popInput').val("");
			}
		}

		$(function() {
			$("#tab").on("click", ":button", function(event) {

				//alert($(this).closest("tr").find("td").eq(0).text() +"--"+)
				tableRow = $(this).closest("tr");
				$('#purchaseWindowTitle').html("商品名："+tableRow.find("td").eq(1).text());
				productId = parseInt(tableRow.find("td").eq(0).text());
				currQuan = parseInt(tableRow.find("td").eq(2).text());
				modal1.style.display = "block";
			});
		});
		function submit(){
			let quantity = Number($('#popInput').val());
			console.log(quantity)
			if(!isNaN(quantity)){
				$.ajax({
					url: "/product/purchase",
					type: "POST",  /*采用POST方法提交*/
					data: {"id": productId, "quantity": quantity},  /*提交的数据（json格式），从输入框中获取*/
					dataType: 'JSON',
					cache: false,
					success: function (result) {
						if(result.code===200){
							console.log("请求成功")
							window.location.reload();
							modal1.style.display = "none";
							$('#popInput').val("");

						}else {
							console.log("请求失败")
						}
					}
				});
			}else {
				console.log("数字格式错误")
			}
		}
		// function find(){
		// 	console.log("请求")
		// 	let key = $('#findInput').val();
		// 	// $.ajax({
		// 	// 	url: "/product/find/",
		// 	// 	type: "POST",  /*采用POST方法提交*/
		// 	// 	data:{"key":key},
		// 	// 	dataType: 'JSON',
		// 	// 	cache: false,
		// 	// 	success: function (data){
		// 	// 		console.log("请求成功")
		// 	// 		console.log(data)
		// 	// 	}
		// 	// });
		// 	window.location.href="/store_manage/find/"+key;
		// }
	</script>

</div>
</div>

</div>

</body>
</html>