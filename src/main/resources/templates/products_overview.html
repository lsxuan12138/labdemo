<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <title>通用批发零售业务管理系统</title>

    <!-- CSS -->
    <link href="bootstrap-4.5.3-dist/css/bootstrap.min.css" th:href="@{/static/bootstrap-4.5.3-dist/css/bootstrap.min.css}" rel="stylesheet">
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="js/jquery-3.5.1.min.js" th:src="@{/static/js/jquery-3.5.1.min.js}"></script>
    <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
    <script src="bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js" th:src="@{/static/bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js}"></script>

    <style type="text/css">
        /* 弹窗 (background) */
        .modal {
            display: none; /* 默认隐藏 */
            position: fixed; /* 固定定位 */
            z-index: 1; /* 设置在顶层 */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
        }

        /* 弹窗内容 */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 20%;
            height: 45%;
        }

        /* 关闭按钮 */
        .close {
            color: #aaa;
            float: top;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-12">
            <h3 class="text-center text-info">
                通用批发零售业务管理系统v1.0
            </h3>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link " href="index.html" th:href="@{/}">返回主菜单</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="client_info_overview.html" th:href="@{/client/all}">顾客资料维护</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active disabled" href="products_overview.html" th:href="@{/product/all}">商品资料维护</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="store_manage.html" th:href="@{/product/store}">库存管理</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="sale_note_manage.html" th:href="@{/saleNote/all}">销售业务管理</a>
                            </li>

                        </ul>
                    </div>
                    <p class="text-info">
                        <strong>您现在访问的是：商品资料维护</strong>
                    </p>
                </div>
            </div>
            <form class="form-inline mb-2 " th:action="@{/product/find}" th:method="post" th:object="${searchInfo}">
                <label for="findInput">商品名称：</label>
                <input class="form-control mr-sm-2 search-query" id="findInput" type="text"  th:placeholder="${keyword}" th:field="*{key}">
                <button class="btn btn-primary mr-sm-2" type="submit">查找</button>
            </form>
            <div class="row ">
                <div class="span3">
                    <input class="form-control" id="product" placeholder="请输入商品名称" type="text">
                </div>
                <div class="span3">
                    <input class="form-control mr-sm-2" id="cost" placeholder="请输入成本价格" type="text">
                </div>
                <div class="span3">
                    <input class="form-control mr-sm-2" id="price" placeholder="请输入售价" type="text">
                </div>
                <div class="span3">
                    <button class="btn btn-large btn-info mr-sm-2" onclick="add()" type="button">添加商品</button>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <table class="table table-bordered table-hover" id="tb">
                        <thead>
                        <tr>
                            <th>商品ID</th>
                            <th>商品名称</th>
                            <th>成本价格</th>
                            <th>售价</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="product:${products}">
                            <td th:text="${product.id}">1</td>
                            <td th:text="${product.name}">华为手机</td>
                            <td th:text="${product.purchasePrice}">4500.0</td>
                            <td th:text="${product.sellPrice}">5000.0</td>
                            <td>
                                <button class="btn btn-info mr-sm-2" onclick=del(this) type="button">删除</button>
                                <button class="btn btn-info mr-sm-2" onclick=edit(this) type="button">修改</button>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                </div>
                <div class="span3">
                    <!-- 弹窗 -->
                    <div class="modal" id="myModal1">
                        <!-- 弹窗内容 -->
                        <div class="modal-content">
                            <div class="modal-body"><!--绑定span-->
                                <span class="close" id="close1">&times;</span>
                                <p>商品名称：</p>
                                <input class="input-medium search-query" id="popName" style="width: 100%" type="text"/>
                                <p>成本价格：</p>
                                <input class="input-medium search-query" id="popCost" style="width: 100%" type="text"/>
                                <p>售价：</p>
                                <input class="input-medium search-query" id="popPrice" style="width: 100%" type="text"/>
                            </div>
                            <button class="btn btn-info btn-large" onclick=change(this) style="display:block;margin:0 auto;width:50%" type="button">确定
                            </button>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
    <script type="text/javascript">
        // 获取弹窗
        var modal1 = document.getElementById('myModal1');


        // 获取 <span> 元素，用于关闭弹窗
        var span1 = document.getElementById("close1");


        // 点击 <span> (x), 关闭弹窗
        span1.onclick = function () {
            modal1.style.display = "none";
        }
        // function add() {
        //     var product = document.getElementById("product").value
        //     var cost = document.getElementById("cost").value
        //     var price = document.getElementById("price").value
        //     var trObj = document.createElement("tr");
        //     trObj.id = new Date().getTime();
        //     trObj.innerHTML = "<td></td>" + "<td>" + product + "</td>" + "<td>" + cost + "</td>"+ "<td>" + price+ "</td>"+"<td>                            <button class=\"btn btn-info mr-sm-2 \" onclick=del(this) type=\"button\">删除</button>\n" +
        //         "<button class=\"btn btn-info mr-sm-2\" type=\"button\">修改</button></td>";
        //     document.getElementById("tb").appendChild(trObj);
        // }
        //
        // function del(obj) {
        //     var tr = obj.parentNode.parentNode //取到了tr对象
        //     tr.parentNode.removeChild(tr) //返回上一层的table删除 他的子节点
        // }
        let popId;
        let popName;
        let popPrice;
        let popCost;
        function edit(obj){
            var value = $(obj).parent().parent().find("td");
            let id = Number(value.eq(0).text());
            let name = value.eq(1).text();
            let cost = Number.parseFloat(value.eq(2).text());
            let price = Number.parseFloat(value.eq(3).text());
            popId =id;
            popName = name;
            popPrice = price;
            popCost = cost;
            $("#popName").val(name);
            $("#popPrice").val(popPrice);
            $("#popCost").val(popCost)
            modal1.style.display="block";
        }
        function change(obj){
            let id = popId;
            let name = $("#popName").val();
            let price = $("#popPrice").val();
            let cost = $("#popCost").val()
            console.log(id+"-"+name+"-"+price+"-"+cost);
            if(isNaN(Number.parseFloat(cost))) {
                alert("数字格式错误");
                return;
            }
            if(isNaN(Number.parseFloat(price))) {
                alert("数字格式错误");
                return;
            }
            if(Number.parseFloat(cost)>Number.parseFloat(price)) {
                alert("成本应低于售价");
                return;
            }
                $.ajax({
                    url: "/product/update",
                    type: "POST",  /*采用POST方法提交*/
                    data: {"id": id,"name":name,"price":price,"cost":cost},  /*提交的数据（json格式），从输入框中获取*/
                    dataType: 'JSON',
                    cache: false,
                    success: function (result) {
                        console.log(result)
                        if (result.code === 200) {
                            console.log("请求成功")
                            window.location.reload();
                        } else {
                            console.log("请求失败")
                        }
                    }

                })

        }
        function add() {
            let productName = $("#product").val();
            let cost = $("#cost").val();
            let price = $("#price").val();
            alert(productName+"-"+cost+"-"+price)
            if(isNaN(Number.parseFloat(cost))) {
                alert("数字格式错误");
                return;
            }
            if(isNaN(Number.parseFloat(price))) {
                alert("数字格式错误");
                return;
            }
            if(Number.parseFloat(cost)>Number.parseFloat(price)) {
                alert("成本应低于售价");
                return;
            }
            // console.log(name)
            // console.log(type)
            $.ajax({
                url: "/product/add",
                type: "POST",  /*采用POST方法提交*/
                data: {"name": productName,"cost":cost,"price":price},  /*提交的数据（json格式），从输入框中获取*/
                dataType: 'JSON',
                cache: false,
                success: function (result) {
                    //alert(result)
                    if(result.code===200){
                        console.log("请求成功")
                        window.location.reload();
                    }else {
                        alert(result.msg)
                    }
                }

            })

        }
        function del(obj) {
            var tr = obj.parentNode.parentNode //取到了tr对象
            var value = $(obj).parent().parent().find("td");
            let id = Number.parseFloat(value.eq(0).text());
            console.log(id)
            if(!isNaN(id)) {
                $.ajax({
                    url: "/product/delete",
                    type: "POST",  /*采用POST方法提交*/
                    data: {"id": id},  /*提交的数据（json格式），从输入框中获取*/
                    dataType: 'JSON',
                    cache: false,
                    success: function (result) {
                        console.log(result)
                        if (result.code === 200) {
                            console.log("请求成功")
                            tr.parentNode.removeChild(tr) //返回上一层的table删除 他的子节点
                            //window.location.reload();
                        } else {
                            console.log("请求失败")
                        }
                    }

                })
            }
        }
    </script>
</div>
</body>
</html>